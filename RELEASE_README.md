# GudaZip 发布准备指南

本文档说明了 GudaZip 项目的发布准备流程，包括环境变量配置、打包和卸载功能。

## 📋 发布准备概述

为了确保 GudaZip 能够正确安装和运行，我们已经完成了以下改进：

1. **环境变量管理**: 将硬编码路径替换为环境变量
2. **打包脚本**: 使用 cx-freeze 生成 MSI 安装包
3. **卸载功能**: 完整的卸载模块，清理所有痕迹
4. **开发环境支持**: 本地开发环境的环境变量设置

## 🔧 环境变量说明

### 环境变量列表

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| `GUDAZIP_INSTALL_PATH` | 安装路径 | `C:\Users\用户名\AppData\Local\GudaZip` |
| `GUDAZIP_RESOURCES_PATH` | 资源文件路径 | `C:\Users\用户名\AppData\Local\GudaZip\resources` |
| `GUDAZIP_ICONS_PATH` | 图标文件路径 | `C:\Users\用户名\AppData\Local\GudaZip\resources\icons\app.ico` |
| `GUDAZIP_CONFIG_PATH` | 配置文件路径 | `C:\Users\用户名\AppData\Roaming\GudaZip` |

### 环境变量的作用

- **安装时**: MSI 安装包会根据用户选择的安装路径自动设置这些环境变量
- **运行时**: 程序通过环境变量获取正确的路径，而不是使用硬编码路径
- **卸载时**: 卸载程序会清理这些环境变量

## 🛠️ 开发环境设置

### 设置开发环境变量

在开发环境中，运行以下脚本来设置环境变量：

```bash
python setup_dev_env.py
```

这个脚本会：
- 检查当前环境变量状态
- 设置开发环境所需的环境变量
- 显示设置后的路径信息

### 验证环境变量

运行脚本后，可以通过以下方式验证：

```bash
# 在命令行中查看环境变量
echo %GUDAZIP_INSTALL_PATH%
echo %GUDAZIP_RESOURCES_PATH%
echo %GUDAZIP_ICONS_PATH%
echo %GUDAZIP_CONFIG_PATH%
```

## 📦 打包流程

### 准备工作

1. 确保所有依赖已安装：
   ```bash
   pip install cx-freeze
   ```

2. 确保项目结构完整，特别是资源文件：
   ```
   src/gudazip/resources/icons/app.ico
   ```

### 执行打包

运行打包脚本：

```bash
python build.py
```

### 打包过程

打包脚本会执行以下步骤：

1. **清理旧的构建文件**
2. **使用 cx-freeze 构建可执行文件**
3. **生成 MSI 安装包配置**
4. **创建许可协议文件**
5. **构建最终的 MSI 安装包**

### 输出文件

打包完成后，会在 `dist/` 目录下生成：
- `GudaZip-1.0.0-win64.msi` - MSI 安装包
- `build/` - 构建临时文件

## 🎯 MSI 安装包功能

### 安装功能

- ✅ 用户可选择安装路径
- ✅ 自动设置环境变量
- ✅ 文件关联（.zip, .rar, .7z）
- ✅ 右键菜单集成
- ✅ 桌面快捷方式
- ✅ 开始菜单项

### 支持的文件格式

安装后，以下文件格式会关联到 GudaZip：
- `.zip` - ZIP 压缩文件
- `.rar` - RAR 压缩文件
- `.7z` - 7-Zip 压缩文件

### 右键菜单

安装后，右键菜单会添加：
- **文件**: "使用 GudaZip 压缩"
- **文件夹**: "使用 GudaZip 压缩"
- **压缩文件**: "使用 GudaZip 解压"

## 🗑️ 卸载功能

### 自动卸载（推荐）

通过 Windows 控制面板的"程序和功能"卸载，会自动清理：
- ✅ 环境变量
- ✅ 文件关联
- ✅ 右键菜单
- ✅ 注册表项
- ✅ 安装文件

### 手动卸载

如果需要手动卸载或清理残留，可以运行：

```bash
python uninstall.py
```

这个脚本会：
1. 检查当前安装状态
2. 询问用户确认
3. 逐步清理所有组件
4. 生成详细的卸载报告
5. 验证卸载结果

### 卸载清理项目

完整卸载会清理：
- 🔧 环境变量
- 📁 文件关联
- 🖱️ 右键菜单
- ⚙️ 配置文件
- 📂 安装目录
- 🗃️ 注册表项

## 🚀 发布检查清单

在发布前，请确保：

### 开发环境测试
- [ ] 运行 `setup_dev_env.py` 设置环境变量
- [ ] 测试程序启动和基本功能
- [ ] 测试文件关联和右键菜单
- [ ] 验证图标和资源文件加载

### 打包测试
- [ ] 运行 `build.py` 成功生成 MSI
- [ ] 在干净的测试环境中安装 MSI
- [ ] 测试安装后的程序功能
- [ ] 测试文件关联和右键菜单
- [ ] 测试卸载功能

### 卸载测试
- [ ] 通过控制面板卸载
- [ ] 运行 `uninstall.py` 验证清理
- [ ] 检查是否有残留文件或注册表项

## 🔍 故障排除

### 常见问题

1. **图标不显示**
   - 检查 `GUDAZIP_ICONS_PATH` 环境变量
   - 确保 `app.ico` 文件存在

2. **文件关联失效**
   - 检查注册表项是否正确
   - 重新运行安装程序

3. **右键菜单不显示**
   - 检查注册表权限
   - 重启 Windows 资源管理器

4. **环境变量未设置**
   - 在开发环境运行 `setup_dev_env.py`
   - 在生产环境重新安装 MSI

### 调试工具

- `setup_dev_env.py` - 设置和检查开发环境
- `uninstall.py` - 完整卸载和状态检查
- Windows 注册表编辑器 - 检查注册表项
- Windows 环境变量设置 - 检查环境变量

## 📝 版本信息

- **版本**: 1.0.0
- **构建工具**: cx-freeze
- **目标平台**: Windows 10/11 (64-bit)
- **Python 版本**: 3.11+

## 📞 支持

如果在发布过程中遇到问题，请检查：
1. 本文档的故障排除部分
2. 项目的日志文件
3. Windows 事件查看器

---

**注意**: 本文档描述的是发布准备流程。在实际发布前，请在多个测试环境中验证所有功能。